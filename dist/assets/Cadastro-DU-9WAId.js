import{r as m,j as e,d as F,B as p,P as L,e as S,f,A as b,b as u,g as N,E as R,F as J,I as W,S as w,M as A,L as E,h as B,C as q}from"./mui-Czmlt3Wi.js";import{a as M}from"./index-xsH4HHeE.js";import{A as _}from"./api-C-m1HPol.js";import{u as k,L as H}from"./index-D5ySl4-Q.js";import"./vendor-DJG_os-6.js";const Q=()=>{const[t,P]=m.useState({cnpj:"",razaoSocial:"",email:"",senha:"",confirmarSenha:"",tipo:"DESPACHANTE"}),[g,j]=m.useState(!1),[o,n]=m.useState(""),[v,y]=m.useState(""),$=k(),D=r=>{const a=r.replace(/\D/g,"");return a.length<=2?a:a.length<=5?a.replace(/(\d{2})(\d{0,3})/,"$1.$2"):a.length<=8?a.replace(/(\d{2})(\d{3})(\d{0,3})/,"$1.$2.$3"):a.length<=12?a.replace(/(\d{2})(\d{3})(\d{3})(\d{0,4})/,"$1.$2.$3/$4"):a.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{0,2})/,"$1.$2.$3/$4-$5")},I=r=>{const a=r.replace(/\D/g,"");if(a.length!==14||/^(\d)\1+$/.test(a))return!1;let s=a.length-2,h=a.substring(0,s),C=a.substring(s),i=0,l=s-7;for(let c=s;c>=1;c--)i+=h.charAt(s-c)*l--,l<2&&(l=9);let x=i%11<2?0:11-i%11;if(x!==parseInt(C.charAt(0)))return!1;s=s+1,h=a.substring(0,s),i=0,l=s-7;for(let c=s;c>=1;c--)i+=h.charAt(s-c)*l--,l<2&&(l=9);return x=i%11<2?0:11-i%11,x===parseInt(C.charAt(1))},d=(r,a)=>{r==="cnpj"&&(a=D(a)),P(s=>({...s,[r]:a})),o&&n("")},z=()=>I(t.cnpj)?t.razaoSocial.trim()?t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)?t.senha.length<6?(n("Senha deve ter pelo menos 6 caracteres"),!1):t.senha!==t.confirmarSenha?(n("Senhas não coincidem"),!1):!0:(n("Email inválido"),!1):(n("Email é obrigatório"),!1):(n("Razão Social é obrigatória"),!1):(n("CNPJ inválido"),!1),T=async r=>{if(r.preventDefault(),!!z()){j(!0),n("");try{const a=await M.post(`${_}/api/auth/cadastro`,{cnpj:t.cnpj.replace(/\D/g,""),razaoSocial:t.razaoSocial,email:t.email,senha:t.senha,tipo:t.tipo});a.data&&a.data.success?(y("✅ Cadastro realizado com sucesso! Redirecionando para login..."),setTimeout(()=>{$("/")},2e3)):n(a.data?.message||"Erro no cadastro")}catch(a){a.response?.status===400?n(a.response.data?.message||"CNPJ já cadastrado ou dados inválidos"):a.response?.status===409?n("CNPJ ou email já cadastrado no sistema"):n("Erro no servidor. Tente novamente.")}finally{j(!1)}}};return e.jsx(F,{component:"main",maxWidth:"sm",children:e.jsx(p,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(L,{elevation:3,sx:{padding:4,width:"100%"},children:e.jsxs(p,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(S,{sx:{fontSize:40,color:"primary.main",mb:2}}),e.jsx(f,{component:"h1",variant:"h4",gutterBottom:!0,children:"📋 Cadastro de Empresa"}),e.jsx(f,{variant:"body2",color:"text.secondary",align:"center",sx:{mb:3},children:"Registre sua empresa para usar o sistema de validação de documentos"}),o&&e.jsx(b,{severity:"error",sx:{width:"100%",mb:2},children:o}),v&&e.jsx(b,{severity:"success",sx:{width:"100%",mb:2},children:v}),e.jsxs(p,{component:"form",onSubmit:T,sx:{width:"100%"},children:[e.jsx(u,{margin:"normal",required:!0,fullWidth:!0,label:"CNPJ",value:t.cnpj,onChange:r=>d("cnpj",r.target.value),placeholder:"00.000.000/0000-00",inputProps:{maxLength:18},error:o&&o.includes("CNPJ"),helperText:o&&o.includes("CNPJ")?o:"Digite o CNPJ da empresa",autoFocus:!0,InputProps:{startAdornment:e.jsx(S,{sx:{color:"action.active",mr:1}})}}),e.jsx(u,{margin:"normal",required:!0,fullWidth:!0,label:"Razão Social",value:t.razaoSocial,onChange:r=>d("razaoSocial",r.target.value),InputProps:{startAdornment:e.jsx(N,{sx:{color:"action.active",mr:1}})}}),e.jsx(u,{margin:"normal",required:!0,fullWidth:!0,label:"Email",type:"email",value:t.email,onChange:r=>d("email",r.target.value),InputProps:{startAdornment:e.jsx(R,{sx:{color:"action.active",mr:1}})}}),e.jsxs(J,{fullWidth:!0,margin:"normal",children:[e.jsx(W,{children:"Tipo de Empresa"}),e.jsxs(w,{value:t.tipo,label:"Tipo de Empresa",onChange:r=>d("tipo",r.target.value),disabled:!0,children:[e.jsx(A,{value:"DESPACHANTE",children:"🚛 Despachante"}),e.jsx(A,{value:"ESTRADA_FACIL",disabled:!0,children:"🔧 Admin (Estrada Fácil)"})]})]}),e.jsx(u,{margin:"normal",required:!0,fullWidth:!0,label:"Senha",type:"password",value:t.senha,onChange:r=>d("senha",r.target.value),InputProps:{startAdornment:e.jsx(E,{sx:{color:"action.active",mr:1}})},helperText:"Mínimo de 6 caracteres"}),e.jsx(u,{margin:"normal",required:!0,fullWidth:!0,label:"Confirmar Senha",type:"password",value:t.confirmarSenha,onChange:r=>d("confirmarSenha",r.target.value),InputProps:{startAdornment:e.jsx(E,{sx:{color:"action.active",mr:1}})}}),e.jsx(B,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(q,{size:20,sx:{mr:1}}),"Cadastrando..."]}):"📝 Cadastrar Empresa"}),e.jsx(p,{sx:{textAlign:"center"},children:e.jsxs(f,{variant:"body2",children:["Já tem uma conta?"," ",e.jsx(H,{to:"/",style:{color:"#1976d2",textDecoration:"none"},children:"🔐 Fazer Login"})]})})]})]})})})})};export{Q as default};
