import{r as a,j as e,d as l,f as r,A as x,P as w,y as R,z as k,G as o,s as z,h as u,B as m,b as $,H as T,J as W}from"./mui-Czmlt3Wi.js";import{a as A}from"./index-xsH4HHeE.js";import{A as h}from"./api-C-m1HPol.js";import{a as O}from"./index-D5ySl4-Q.js";import"./vendor-DJG_os-6.js";function V(){const{token:n}=O(),[s,C]=a.useState(null),[j,E]=a.useState(""),[D,S]=a.useState(!0),[i,p]=a.useState(!1),[c,d]=a.useState(""),[v,P]=a.useState("");a.useEffect(()=>{y()},[n]);const y=async()=>{try{const t=await A.get(`${h}/aprovacao/${n}`);C(t.data)}catch{d("Documento n칚o encontrado ou token inv치lido")}finally{S(!1)}},g=async t=>{p(!0),d("");try{await A.post(`${h}/aprovacao/${n}`,{aprovado:t,comentarios:j}),P(`Documento ${t?"aprovado":"rejeitado"} com sucesso! O despachante foi notificado por email.`),setTimeout(()=>{y()},2e3)}catch(f){d(f.response?.data||"Erro ao processar aprova칞칚o")}finally{p(!1)}},b=t=>new Date(t).toLocaleString("pt-BR"),B=t=>{switch(t){case"PENDENTE":return"warning";case"APROVADO":return"success";case"REJEITADO":return"error";default:return"default"}};return D?e.jsx(l,{maxWidth:"md",sx:{mt:4},children:e.jsx(r,{align:"center",children:"Carregando..."})}):c&&!s?e.jsx(l,{maxWidth:"md",sx:{mt:4},children:e.jsx(x,{severity:"error",children:c})}):e.jsx(l,{maxWidth:"md",sx:{mt:4},children:e.jsxs(w,{sx:{p:4},children:[e.jsx(r,{variant:"h4",gutterBottom:!0,align:"center",children:"Valida칞칚o de Documento"}),e.jsx(r,{variant:"h6",gutterBottom:!0,align:"center",color:"text.secondary",children:"Estrada F치cil - Sistema de Aprova칞칚o"}),v&&e.jsx(x,{severity:"success",sx:{mb:3},children:v}),c&&e.jsx(x,{severity:"error",sx:{mb:3},children:c}),s&&e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"outlined",sx:{mb:3},children:e.jsx(k,{children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:s.titulo}),e.jsx(z,{label:s.status,color:B(s.status),size:"small"})]}),e.jsxs(o,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Motorista"}),e.jsx(r,{variant:"body1",children:s.nomeMotorista})]}),e.jsxs(o,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Despachante"}),e.jsx(r,{variant:"body1",children:s.empresaRemetente?.razaoSocial})]}),e.jsxs(o,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Data de Envio"}),e.jsx(r,{variant:"body1",children:b(s.dataEnvio)})]}),s.descricao&&e.jsxs(o,{item:!0,xs:12,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Descri칞칚o"}),e.jsx(r,{variant:"body1",children:s.descricao})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Arquivo"}),e.jsxs(r,{variant:"body1",sx:{mb:1},children:["游늹 ",s.nomeArquivoOriginal]}),e.jsx(u,{variant:"outlined",color:"primary",onClick:()=>{window.open(`${h}/aprovacao/${n}/arquivo`,"_blank")},size:"small",children:"游닌 Visualizar/Baixar Arquivo"})]})]})})}),s.status==="PENDENTE"?e.jsxs(m,{children:[e.jsx($,{fullWidth:!0,label:"Coment치rios (opcional)",multiline:!0,rows:3,value:j,onChange:t=>E(t.target.value),sx:{mb:3},placeholder:"Adicione coment치rios sobre a decis칚o..."}),e.jsxs(m,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(u,{variant:"contained",color:"success",size:"large",startIcon:e.jsx(T,{}),onClick:()=>g(!0),disabled:i,sx:{minWidth:150},children:i?"Processando...":"Aprovar"}),e.jsx(u,{variant:"contained",color:"error",size:"large",startIcon:e.jsx(W,{}),onClick:()=>g(!1),disabled:i,sx:{minWidth:150},children:i?"Processando...":"Rejeitar"})]})]}):e.jsxs(m,{sx:{textAlign:"center",p:3,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Este documento j치 foi processado"}),e.jsxs(r,{variant:"body1",sx:{mb:2},children:["Status: ",e.jsx("strong",{children:s.status})]}),s.comentarios&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Coment치rios: ",s.comentarios]}),s.dataAprovacao&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Processado em: ",b(s.dataAprovacao)]})]})]})]})})}export{V as default};
